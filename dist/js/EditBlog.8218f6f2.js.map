{"version":3,"file":"EditBlog.8218f6f2.js","sources":["../../src/utils.ts","../../src/components/container/blog/EditBlog.vue"],"sourcesContent":["/**\n * 防抖\n * @param func\n * @param delay\n * @param immediate\n */\nexport function debounce(func: Function, delay: number, immediate = false) {\n  let timer: number | null = null;\n  const isDone = immediate;\n  return function () {\n    //@ts-ignore\n    const context = this;\n    // eslint-disable-next-line prefer-rest-params\n    const args = arguments;\n    if (timer) {\n      clearTimeout(timer);\n    }\n    // 立即触发\n    if (immediate) {\n      func.apply(context, args);\n      immediate = false;\n    }\n    timer = setTimeout(() => {\n      func.apply(context, args);\n      if (isDone) {\n        immediate = true;\n      }\n    }, delay);\n  };\n}\n","<template>\n  <div class=\"edit-blog\">\n    <el-form ref=\"formRef\">\n      <el-form-item label=\"标题\">\n        <el-input v-model=\"data.payload.title\" />\n      </el-form-item>\n      <el-form-item label=\"标签\">\n        <!-- <el-input v-model=\"data.tag\" /> -->\n        {{ data.tagNm }}\n        <el-tag\n          @click=\"\n            data.tag = '5';\n            data.tagNm = '面试';\n          \"\n        >\n          面试\n        </el-tag>\n        <el-tag\n          @click=\"\n            data.tag = '4';\n            data.tagNm = '微信小程序';\n          \"\n        >\n          微信小程序\n        </el-tag>\n      </el-form-item>\n    </el-form>\n\n    <v-md-editor\n      v-model=\"data.payload.context\"\n      :height=\"data.textHeight\"\n      @copy-code-success=\"handleCopyCodeSuccess\"\n      @save=\"save\"\n    ></v-md-editor>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport {reactive, ref, onMounted} from 'vue';\nimport {saveOrUpdateApi, selectByIdApi} from '@/api/blog';\nimport {ElMessage, type FormInstance} from 'element-plus';\n\nimport {useRoute, useRouter} from 'vue-router';\nimport {debounce} from '@/utils';\nimport type {SaveOrUpdateBlogPayload} from '@/api/interface/blog';\nconst router = useRouter();\nconst route = useRoute();\nconst formRef = ref<FormInstance>();\nconst data = reactive({\n  textHeight: '0px',\n  tag: '',\n  tagNm: '',\n  payload: {\n    id: undefined,\n    title: '',\n    context: '',\n    picture: '',\n    contextHtml: '',\n    tagIds: null,\n  } as SaveOrUpdateBlogPayload,\n});\n\nonMounted(() => {\n  const height = formRef.value?.$el.clientHeight;\n  data.textHeight = `calc( 100vh - 40px - 20px - ${height}px)`;\n\n  const id = route.query.id as string;\n  if (id) {\n    selectByIdApi(id).then((resp) => {\n      if (resp) {\n        data.tag = resp[0].tags[0]?.id + '';\n        data.tagNm = resp[0].tags[0]?.name;\n        data.payload.context = resp[0].context;\n        data.payload.contextHtml = resp[0].contextHtml;\n        data.payload.title = resp[0].title;\n        data.payload.id = resp[0].id;\n      }\n    });\n  }\n});\n\n/* 复制代码 */\nfunction handleCopyCodeSuccess(code: string) {\n  console.log(code);\n}\n/* 保存文档 */\nconst save = debounce(async (text: string, html: string) => {\n  // if (data.tag) {\n  //   data.payload.tagIds = (await insertTagApi(data.tag))?.id || null;\n  // }\n  data.payload.tagIds = data.tag;\n  data.payload.contextHtml = html;\n  const resp = await saveOrUpdateApi(data.payload);\n  if (resp?.id) {\n    ElMessage.success('保存成功');\n    router.push(`/blog/context/${resp.id}`);\n  }\n}, 500);\n</script>\n<style lang=\"less\" scoped>\n.edit-blog {\n  padding: 20px;\n}\n</style>\n"],"names":["debounce","func","delay","immediate","timer","isDone","context","args","router","useRouter","route","useRoute","formRef","ref","data","reactive","onMounted","height","_a","id","selectByIdApi","resp","_b","handleCopyCodeSuccess","code","save","text","html","saveOrUpdateApi","ElMessage"],"mappings":"+LAMO,SAASA,EAASC,EAAgBC,EAAeC,EAAY,GAAO,CACzE,IAAIC,EAAuB,KAC3B,MAAMC,EAASF,EACf,OAAO,UAAY,CAEjB,MAAMG,EAAU,KAEVC,EAAO,UACTH,GACF,aAAaA,CAAK,EAGhBD,IACGF,EAAA,MAAMK,EAASC,CAAI,EACZJ,EAAA,IAEdC,EAAQ,WAAW,IAAM,CAClBH,EAAA,MAAMK,EAASC,CAAI,EACpBF,IACUF,EAAA,KAEbD,CAAK,CAAA,CAEZ,6DCgBA,MAAMM,EAASC,IACTC,EAAQC,IACRC,EAAUC,IACVC,EAAOC,EAAS,CACpB,WAAY,MACZ,IAAK,GACL,MAAO,GACP,QAAS,CACP,GAAI,OACJ,MAAO,GACP,QAAS,GACT,QAAS,GACT,YAAa,GACb,OAAQ,IACV,CAAA,CACD,EAEDC,EAAU,IAAM,OACR,MAAAC,GAASC,EAAAN,EAAQ,QAAR,YAAAM,EAAe,IAAI,aAClCJ,EAAK,WAAa,+BAA+BG,OAE3C,MAAAE,EAAKT,EAAM,MAAM,GACnBS,GACFC,EAAcD,CAAE,EAAE,KAAME,GAAS,SAC3BA,IACFP,EAAK,MAAMI,EAAAG,EAAK,GAAG,KAAK,KAAb,YAAAH,EAAiB,IAAK,GACjCJ,EAAK,OAAQQ,EAAAD,EAAK,GAAG,KAAK,KAAb,YAAAC,EAAiB,KACzBR,EAAA,QAAQ,QAAUO,EAAK,GAAG,QAC1BP,EAAA,QAAQ,YAAcO,EAAK,GAAG,YAC9BP,EAAA,QAAQ,MAAQO,EAAK,GAAG,MACxBP,EAAA,QAAQ,GAAKO,EAAK,GAAG,GAC5B,CACD,CACH,CACD,EAGD,SAASE,EAAsBC,EAAc,CAC3C,QAAQ,IAAIA,CAAI,CAClB,CAEA,MAAMC,EAAOzB,EAAS,MAAO0B,EAAcC,IAAiB,CAIrDb,EAAA,QAAQ,OAASA,EAAK,IAC3BA,EAAK,QAAQ,YAAca,EAC3B,MAAMN,EAAO,MAAMO,EAAgBd,EAAK,OAAO,EAC3CO,GAAA,MAAAA,EAAM,KACRQ,EAAU,QAAQ,0BAAM,EACjBrB,EAAA,KAAK,iBAAiBa,EAAK,IAAI,IAEvC,GAAG"}